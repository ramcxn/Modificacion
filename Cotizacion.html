<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cotización - Talleres Barrera</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <link rel="stylesheet" href="https://ramcxn.github.io/Modificacion/cotizacion.css"/>

    <style>
        /* ✅ CSS: Oculta por defecto todas las secciones que son opcionales */
        .seccion-opcional {
            display: none;
        }

        /* --- Estilos generales que ya teníamos --- */
        .section {
            margin-bottom: 5px; 
            break-inside: avoid;
            page-break-inside: avoid;
        }
        .image-container {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-start;
        }
        .reference-image {
            max-width: 220px; max-height: 180px; width: auto; height: auto;
            object-fit: contain; border: 1px solid #e5e7eb; padding: 4px;
            border-radius: 6px; background: #fff;
        }
        .notes-list {
            padding-left: 20px; margin: 0; list-style-type: disc;
        }
        .observation-title {
            list-style-type: none; margin-left: -20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="actions-bar">
            <button class="action-button" onclick="window.print()"><i class="fas fa-print"></i> Imprimir</button>
            <button id="btnPdf" class="action-button" onclick="downloadPDF()"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
            <button id="btnMail" class="action-button" onclick="emailWithPdf()"><i class="fas fa-envelope"></i> Enviar por correo</button>
        </div>
        <div class="header">
            <div class="header-info">
                <h1>COTIZACIÓN</h1>
                <h2>TALLERES BARRERA S.A. DE C.V.</h2>
                <p><strong>Dirección:</strong> Industria Automotriz #126, Col. Parque Industrial, CP 67735, Linares N.L. México</p>
                <p><strong>Teléfono:</strong> <span id="telefonoContacto"></span></p>
                <p><strong>Correo:</strong> <span id="correoContacto"></span></p>
                <p><strong>RFC:</strong> TBA7504018B4</p>
            </div>
            <img id="logoPrincipal" src="https://raw.githubusercontent.com/ramcxn/Modificacion/main/LOGO%20TB2025.png" alt="Logo de Talleres Barrera" class="logo" style="width: 50%; height: auto;" crossorigin="anonymous" referrerpolicy="no-referrer">
        </div>
        <p>Por medio de la presente, <strong>TALLERES BARRERA S.A. DE C.V.</strong> agradece su interés en nuestros productos...</p>
        
        <div class="section">
            <h3 class="section-title">Información del Cliente y General</h3>
            <table class="info-table">
                <tr><td>Fecha de Cotización:</td><td><span id="fechaCotizacion"></span></td></tr>
                <tr><td>Cliente:</td><td><span id="cliente"></span></td></tr>
                <tr><td>Dirección del Cliente:</td><td><span id="direccionCliente"></span></td></tr>
                <tr><td>RFC del Cliente:</td><td><span id="rfcCliente"></span></td></tr>
                <tr><td>Tipo de Unidad:</td><td><span id="tipoUnidad"></span></td></tr>
                <tr><td>Realizado por (Vendedor):</td><td><span id="realizadoPor"></span></td></tr>
            </table>
        </div>

        <div class="section seccion-opcional" id="jaula-specs-1">
            <h3 class="section-title">Especificaciones Generales</h3>
            <table class="info-table">
                <tr><td>Color Primario:</td><td><span id="colorPrimario"></span></td></tr>
                <tr><td>Color Secundario:</td><td><span id="colorSecundario"></span></td></tr>
                <tr><td>Suspensión:</td><td><span id="suspension"></span> (<span id="cantSuspensiones"></span> piezas)</td></tr>
                <tr><td>Retráctil de Eje:</td><td><span id="retractilEje"></span></td></tr>
                <tr><td>Ejes:</td><td><span id="ejes"></span></td></tr>
                <tr><td>Distancia entre Ejes:</td><td><span id="distanciaEjes"></span></td></tr>
                <tr><td>Personalización de Viga:</td><td><span id="personalizacionViga"></span></td></tr>
                <tr><td>Faldón:</td><td><span id="faldon"></span></td></tr>
                <tr><td>Perno Rey:</td><td><span id="pernoRey"></span></td></tr>
                <tr><td>Portallantas:</td><td><span id="portallantas"></span></td></tr>
            </table>
        </div>
        <div class="section seccion-opcional" id="jaula-specs-2">
            <h3 class="section-title">Carrocería y Estructura</h3>
            <table class="info-table">
                <tr><td>Dimensiones:</td><td><span id="dimensiones"></span></td></tr>
                <tr><td>Tipo de Redila:</td><td><span id="tipoRedila"></span></td></tr>
                <tr><td>Secciones:</td><td><span id="secciones"></span></td></tr>
                <tr><td>Puertas Laterales:</td><td><span id="puertasLaterales"></span></td></tr>
                <tr><td>Compuerta al Piso:</td><td><span id="compAlPiso"></span></td></tr>
                <tr><td>Compuerta Trasera:</td><td><span id="compAtras"></span></td></tr>
                <tr><td>Tipo de Arco:</td><td><span id="tipoArco"></span></td></tr>
                <tr><td>Piso de Madera:</td><td><span id="pisoMadera"></span></td></tr>
                <tr><td>Piso Laminado:</td><td><span id="pisoLaminado"></span></td></tr>
                <tr><td>Caballete:</td><td><span id="caballete"></span></td></tr>
                <tr><td>Tubos Interiores:</td><td><span id="tubosInteriores"></span></td></tr>
                <tr><td>Barrote Lateral:</td><td><span id="barroteLateral"></span></td></tr>
                <tr><td>Compuerta a los Lados:</td><td><span id="compuertaLados"></span></td></tr>
                <tr><td>Cerrojo de Puertas Traseras:</td><td><span id="cerrojoPuertas"></span></td></tr>
                <tr><td>Sistema de Lona:</td><td><span id="sistemaLona"></span></td></tr>
                <tr><td>Luz de Placa:</td><td><span id="luzPlaca"></span></td></tr>
            </table>
        </div>
        <div class="section seccion-opcional" id="jaula-accesorios">
            <h3 class="section-title">Accesorios</h3>
            <table class="info-table">
                <tr><td>Rines:</td><td><span id="rines"></span> (<span id="cantRines"></span> piezas)</td></tr>
                <tr><td>Llantas:</td><td><span id="llantas"></span> (<span id="cantLlantas"></span> piezas)</td></tr>
                <tr><td>Frenos:</td><td><span id="frenos"></span></td></tr>
                <tr><td>Juego de Patines:</td><td><span id="juegoPatines"></span> (<span id="cantPatines"></span> piezas)</td></tr>
                <tr><td>Caja de Herramientas:</td><td><span id="cajaHerramientas"></span></td></tr>
                <tr><td>Lodera Delantera:</td><td><span id="loderaDelantera"></span></td></tr>
                <tr><td>Lodera Trasera:</td><td><span id="loderaTrasera"></span></td></tr>
                <tr><td>Manivelas de Patín:</td><td><span id="manivelasPatin"></span></td></tr>
                <tr><td>Direccionales:</td><td><span id="direccionales"></span></td></tr>
                <tr><td>Plafones:</td><td><span id="plafones"></span></td></tr>
            </table>
        </div>

        <div class="section seccion-opcional" id="dolly-specs">
            <h3 class="section-title">Especificaciones de la Unidad</h3>
            <table class="info-table">
                <tr><td>Color Primario:</td><td><span id="colorPrimarioDolly"></span></td></tr>
                <tr><td>Color Secundario:</td><td><span id="colorSecundarioDolly"></span></td></tr>
                <tr><td>Suspensión:</td><td><span id="suspensionDolly"></span> (<span id="cantSuspensionesDolly"></span> piezas)</td></tr>
                <tr><td>Retráctil de Eje:</td><td><span id="retractilEjeDolly"></span></td></tr>
                <tr><td>Ejes:</td><td><span id="ejesDolly"></span></td></tr>
                <tr><td>Faldón:</td><td><span id="faldonDolly"></span></td></tr>
                <tr><td>Lanza:</td><td><span id="lanza"></span></td></tr>
                <tr><td>Distancia entre Ejes:</td><td><span id="distanciaEjesDolly"></span></td></tr>
                <tr><td>Personalización de Viga:</td><td><span id="personalizacionVigaDolly"></span></td></tr>
            </table>
        </div>
        <div class="section seccion-opcional" id="dolly-accesorios">
            <h3 class="section-title">Accesorios</h3>
            <table class="info-table">
                <tr><td>Rines:</td><td><span id="rinesDolly"></span> (<span id="cantRinesDolly"></span> piezas)</td></tr>
                <tr><td>Llantas:</td><td><span id="llantasDolly"></span> (<span id="cantLlantasDolly"></span> piezas)</td></tr>
                <tr><td>Frenos:</td><td><span id="frenosDolly"></span></td></tr>
                <tr><td>Sistema de Inflado PSI:</td><td><span id="sistemaInflado"></span></td></tr>
                <tr><td>Quinta Rueda:</td><td><span id="quintaRueda"></span></td></tr>
                <tr><td>Plafones:</td><td><span id="plafonesDolly"></span></td></tr>
                <tr><td>Argolla:</td><td><span id="argolla"></span></td></tr>
            </table>
        </div>

        <div class="section">
            <h3 class="section-title">Imágenes de Referencia</h3>
            <div class="image-container" id="imagenes-container"></div>
        </div>
        <div class="section">
            <h3 class="section-title">Observaciones y modificaciones a la unidad</h3>
            <ul class="notes-list" id="observaciones-lista"></ul>
        </div>
        <div class="section">
            <h3 class="section-title">Resumen de Costos y Términos de Pago</h3>
            </div>
        </div>

    <script>
        // --- Funciones de ayuda (getParam, money, etc.) se mantienen igual ---
        const urlParams = new URLSearchParams(window.location.search);
        const getParam = (name) => { /* ... (código sin cambios) ... */ };
        const getParamRaw = (name) => { /* ... (código sin cambios) ... */ };
        // ... (resto de funciones de ayuda) ...

        function fillData() {
            // ... (código para llenar fecha, cliente, etc., se mantiene igual) ...

            // ✅ JAVASCRIPT: El "Mesero Inteligente"
            // 1. Mapa de configuración
            const configuracionUnidades = {
                'Jaula': ['jaula-specs-1', 'jaula-specs-2', 'jaula-accesorios'],
                'Dolly': ['dolly-specs', 'dolly-accesorios']
                // Agrega aquí más tipos de unidad en el futuro
            };

            // 2. Lógica para mostrar las secciones correctas
            const tipoUnidad = getParam('tipo_de_unidad');
            const seccionesAMostrar = configuracionUnidades[tipoUnidad];

            if (seccionesAMostrar) {
                seccionesAMostrar.forEach(idDeLaSeccion => {
                    const seccion = document.getElementById(idDeLaSeccion);
                    if (seccion) {
                        seccion.style.display = 'block'; // Se hace visible
                    }
                });
            } else {
                // Si no se reconoce el tipo de unidad, no se mostrarán secciones opcionales
                console.error(`Tipo de unidad "${tipoUnidad}" no reconocido.`);
            }

            // --- Llenado de TODOS los campos ---
            // El script llenará todos los spans, pero solo serán visibles los de las secciones activas.
            
            // Campos de Cliente (siempre se llenan)
            document.getElementById('cliente').innerText = getParam('cliente');
            // ... (resto de campos de cliente) ...

            // --- Campos de Jaula ---
            document.getElementById('colorPrimario').innerText = getParam('color');
            // ... (todos los demás spans de Jaula) ...

            // --- Campos de Dolly ---
            // NOTA: Debes darles IDs únicos en el HTML si los nombres de campo se repiten
            document.getElementById('colorPrimarioDolly').innerText = getParam('color');
            // ... (todos los demás spans de Dolly) ...

            // ... (resto del script para observaciones, imágenes, costos, etc., se mantiene igual) ...
        }

        // --- Resto del script (loadImages, downloadPDF, emailWithPdf, etc.) ---
        // ... (código sin cambios) ...

        document.addEventListener('DOMContentLoaded', fillData);
    </script>
</body>
</html>
